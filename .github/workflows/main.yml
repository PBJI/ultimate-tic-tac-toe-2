name: Update Branch Strategy

on:
  push: # Remove the branches filter to run on all branches

jobs:
  generate-log:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Generate Git Log
      run: |
        git log --all --decorate --oneline --graph > git-log.txt
        echo "::set-output name=log::$(cat git-log.txt)"

    - name: Update README
      id: readme-update
      run: |
        # Replace the content within the "Branch Strategy" section
        sed -i '/# Branch Strategy/ {
            N
            s/\(.*\)\n\(.*\)/# Branch Strategy\n\nHere is the Git log for all branches in the repository:\n\n```\n'"${LOG_CONTENT}"'\n```\n\n# Other Sections/
        }' README.md
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Push Changes
      run: |
        git config --global user.email "your-email@example.com"
        git config --global user.name "Your Name"
        git add .
        git commit -m "Automated commit"
        git push --quiet "https://${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git" main
      env:
        LOG_CONTENT: ${{ steps.generate-log.outputs.log }}
